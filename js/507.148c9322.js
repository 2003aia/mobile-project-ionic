"use strict";(self["webpackChunktest"]=self["webpackChunktest"]||[]).push([[507],{6651:function(t,e,a){a.d(e,{U:function(){return i}});a(7658);var n=a(6086),s=a(9669),o=a.n(s),r=a(3978),c=a(7030);const i=(0,n.Q_)({id:"personalAccount",state:()=>({addAccountResponse:null,addAccountError:null,getSettlementsResponse:null,getSettlementsError:null,getStreetsResponse:null,getStreetsError:null,getHousesResponse:null,getHousesError:null,getAccountResponse:null,paymentHistoryResponse:null,paymentHistoryError:null,sberPayResponse:null,sberPayError:null,getAccountError:null,delAccountResponse:{error:!1,data:null},delAccountError:null,getIndicesResponse:null,getIndicesError:null,setIndicesResponse:null,setIndicesError:null,personalItemData:{}}),getters:{getSettlementsList:t=>t.getSettlementsResponse.data.flatMap((t=>t?.settlements.flatMap((t=>t))))},actions:{async getSettlements(){console.log("getting settlements");try{const t=new r.K;await t.create();const e=await t.get("token"),a=JSON.parse(e).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetSettlements",{token:a}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.getSettlementsResponse=t.data}))}catch(t){this.getSettlementsError=t}},async getStreets(t){try{const e=new r.K;await e.create();const a=await e.get("token"),n=JSON.parse(a).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetStreets",{token:n,s_id:t}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.getStreetsResponse=t.data}))}catch(e){this.getStreetsError=e}},async getHouses(t){try{const e=new r.K;await e.create();const a=await e.get("token"),n=JSON.parse(a).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetHouses",{token:n,ids:t}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.getHousesResponse=t.data}))}catch(e){this.getHousesError=e}},async getAccount(){try{const t=new r.K;await t.create();const e=await t.get("token"),a=JSON.parse(e).token,n=JSON.parse(e).lics;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetAccount",{token:a,LC:n}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.getAccountResponse=t.data}))}catch(t){this.getAccountError=t}},async addAccount(t,e){try{await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/AddAccount",{token:t,LC:e}).then((async t=>{this.addAccountResponse=t.data,t.data.error&&c.Z.push("/authPage");const a=new r.K;await a.create();const n=await a.get("token"),s=JSON.parse(n);await a.set("token",JSON.stringify({...s,lics:[...s.lics,e]}))}))}catch(a){this.addAccountError=a}},async delAccount(t){try{const e=new r.K;await e.create();const a=await e.get("token"),n=JSON.parse(a).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/DelAccount",{token:n,LC:t}).then((async n=>{this.getAccountResponse.data=this.getAccountResponse?.data.filter((e=>e.code!==t)),n.data.error&&c.Z.push("/authPage");const s=JSON.parse(a),o=this.getAccountResponse?.data.filter((e=>e?.code!==t)),r={name:s.name,phone:s.phone,email:s.email,password:s.password,token:s.token,lics:o?.map((t=>t?.code))};await e.set("token",JSON.stringify(r)),this.delAccountResponse=n.data}))}catch(e){this.delAccountError=e}},async getPayments(t,e,a){try{const n=new r.K;await n.create();const s=await n.get("token"),i=JSON.parse(s).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetPayments",{token:i,LC:t,beginPeriod:e,endPeriod:a}).then((async t=>{t.data.error&&c.Z.push("/authPage"),this.paymentHistoryResponse=t.data}))}catch(n){this.paymentHistoryError=n}},async getIndices(t,e,a){try{const n=new r.K;await n.create();const s=await n.get("token"),i=JSON.parse(s).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/GetIndices",{token:i,counterId:t,beginPeriod:e,endPeriod:a}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.getIndicesResponse=t.data}))}catch(n){this.getIndicesError=n}},async setIndices(t,e){try{const a=new r.K;await a.create();const n=await a.get("token"),s=JSON.parse(n).token;await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/SetIndices",{token:s,counterId:t,indice:e}).then((e=>{this.setIndicesResponse=e.data,!1===e.data.error&&(this.getIndices(t),this.setIndicesResponse=e.data)}))}catch(a){this.setIndicesError=a}},async sberPay(t,e,a,n){try{const s=new r.K;await s.create();const i=await s.get("token"),l=JSON.parse(i);await o().post("https://fhd.aostng.ru/vesta_storage/hs/API_STNG/V2/SberPay",{token:l.token,phone:e,email:a,LC:t,accruals:n}).then((t=>{t.data.error&&c.Z.push("/authPage"),this.sberPayResponse=t.data}))}catch(s){this.sberPayError=s}}}})},1496:function(t,e,a){a.d(e,{Z:function(){return l}});var n=a(6252),s=a(3577);function o(t,e,a,o,r,c){return(0,n.wg)(),(0,n.iD)("div",{class:(0,s.C_)(["main",{padding:t.padding}]),onClick:e[0]||(e[0]=(...e)=>t.onClick&&t.onClick(...e))},[(0,n.WI)(t.$slots,"content",{},void 0,!0)],2)}var r=(0,n.aZ)({setup(){},name:"layoutBox",components:{},props:{padding:Boolean,btnSrc:String,filledButton:String,title:String,height:String,onClick:Function}}),c=a(3744);const i=(0,c.Z)(r,[["render",o],["__scopeId","data-v-568da44e"]]);var l=i},507:function(t,e,a){a.r(e),a.d(e,{default:function(){return A}});a(7658);var n=a(6252);const s=t=>((0,n.dD)("data-v-23d9afa0"),t=t(),(0,n.Cn)(),t),o=s((()=>(0,n._)("p",{class:"ion-text-start"}," Введите адрес электронной почты (email) или номер телефона ",-1))),r=s((()=>(0,n._)("p",null,"Электронная почта",-1))),c={class:"container"},i=s((()=>(0,n._)("p",{class:"title"},"Выберите удобный вам способ оплаты",-1)));function l(t,e,a,s,l,u){const d=(0,n.up)("Back"),h=(0,n.up)("ion-text"),p=(0,n.up)("Input"),g=(0,n.up)("Layout"),w=(0,n.up)("layout-box"),y=(0,n.up)("ion-content"),m=(0,n.up)("ion-page");return(0,n.wg)(),(0,n.j4)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{btnSrc:()=>t.router.push("/tabs/personalAccounts")},null,8,["btnSrc"]),!1===t.paySent?((0,n.wg)(),(0,n.j4)(g,{key:0,method:t.paymentHandler,height:"false",outlineBtn:".",filledBtn:"Оплатить",title:"Оплатить"},{"main-content":(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[o])),_:1}),t.email?((0,n.wg)(),(0,n.j4)(p,{key:0,name:"Введите email",value:t.email,changeHandler:t.changeEmail},null,8,["value","changeHandler"])):((0,n.wg)(),(0,n.j4)(h,{key:1},{default:(0,n.w5)((()=>[r])),_:1})),(0,n.Wm)(p,{name:"Введите номер телефона",value:t.phone,changeHandler:t.changePhone},null,8,["value","changeHandler"]),(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" На электронную почту или на мобильный телефон будет направлен кассовый чек ")])),_:1})])),_:1},8,["method"])):((0,n.wg)(),(0,n.j4)(y,{key:1,class:"background"},{default:(0,n.w5)((()=>[(0,n._)("div",c,[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[i])),_:1}),(0,n.Wm)(w,{onClick:t.sberPayHanler},{content:(0,n.w5)((()=>[(0,n.Wm)(h,{class:"ion-text-center title"},{default:(0,n.w5)((()=>[(0,n.Uk)("Оплатить платежной картой")])),_:1})])),_:1},8,["onClick"])])])),_:1}))])),_:1})}var u=a(2201),d=a(2492),h=a(1496),p=a(9196),g=a(2684),w=a(8903),y=a(2166),m=a(3978),k=a(6086),S=a(6651),P=(0,n.aZ)({name:"personalAccauntPayPage",components:{Back:y.Z,IonPage:g._i,Layout:d.Z,IonText:g.yW,Input:p.Z,LayoutBox:h.Z,IonContent:g.W2},data(){return{phone:"",email:"",paySent:!1}},methods:{...(0,k.nv)(S.U,["sberPay"]),changePhone(t){this.$data.phone=t.target.value},changeEmail(t){this.$data.email=t.target.value},paymentHandler(){this.sberPay(this.$pinia.state.value.personalAccount.personalItemData.code,this.$data.phone,this.$data.email,this.$pinia.state.value.personalAccount.personalItemData.sberPay.accruals),this.$data.paySent=!0},sberPayHanler(){window.open(this.$pinia.state.value?.personalAccount?.sberPayResponse?.link,"_system")}},setup(){const t=(0,u.tv)();return{router:t,pencilOutline:w.Tvs,documentTextOutline:w.L82,chevronForwardOutline:w.Dji}},mounted(){const t=new m.K;console.log(this.$route.params,"params pay");const e=async()=>{await t.create();const e=await t.get("token"),a=JSON.parse(e);this.$data.phone=a.phone,this.$data.email=a.email};e()}}),_=a(3744);const f=(0,_.Z)(P,[["render",l],["__scopeId","data-v-23d9afa0"]]);var A=f}}]);
//# sourceMappingURL=507.148c9322.js.map